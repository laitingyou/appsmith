"use strict";(self.webpackChunkappsmith=self.webpackChunkappsmith||[]).push([[982],{20201:function(n,e,t){t.r(e),t.d(e,{RichTextEditorInputWrapper:function(){return _},RichtextEditorComponent:function(){return P},default:function(){return L}});var o,i,r=t(50678),a=t(17186),s=t(72791),c=t(86538),l=t(52007),u=function(){return u=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},u.apply(this,arguments)},d={onActivate:l.func,onAddUndo:l.func,onBeforeAddUndo:l.func,onBeforeExecCommand:l.func,onBeforeGetContent:l.func,onBeforeRenderUI:l.func,onBeforeSetContent:l.func,onBeforePaste:l.func,onBlur:l.func,onChange:l.func,onClearUndos:l.func,onClick:l.func,onContextMenu:l.func,onCopy:l.func,onCut:l.func,onDblclick:l.func,onDeactivate:l.func,onDirty:l.func,onDrag:l.func,onDragDrop:l.func,onDragEnd:l.func,onDragGesture:l.func,onDragOver:l.func,onDrop:l.func,onExecCommand:l.func,onFocus:l.func,onFocusIn:l.func,onFocusOut:l.func,onGetContent:l.func,onHide:l.func,onInit:l.func,onKeyDown:l.func,onKeyPress:l.func,onKeyUp:l.func,onLoadContent:l.func,onMouseDown:l.func,onMouseEnter:l.func,onMouseLeave:l.func,onMouseMove:l.func,onMouseOut:l.func,onMouseOver:l.func,onMouseUp:l.func,onNodeChange:l.func,onObjectResizeStart:l.func,onObjectResized:l.func,onObjectSelected:l.func,onPaste:l.func,onPostProcess:l.func,onPostRender:l.func,onPreProcess:l.func,onProgressState:l.func,onRedo:l.func,onRemove:l.func,onReset:l.func,onSaveContent:l.func,onSelectionChange:l.func,onSetAttrib:l.func,onSetContent:l.func,onShow:l.func,onSubmit:l.func,onUndo:l.func,onVisualAid:l.func},p=u({apiKey:l.string,id:l.string,inline:l.bool,init:l.object,initialValue:l.string,onEditorChange:l.func,outputFormat:l.oneOf(["html","text"]),value:l.string,tagName:l.string,cloudChannel:l.string,plugins:l.oneOfType([l.string,l.array]),toolbar:l.oneOfType([l.string,l.array]),disabled:l.bool,textareaName:l.string,tinymceScriptSrc:l.string,rollback:l.oneOfType([l.number,l.oneOf([!1])]),scriptLoading:l.shape({async:l.bool,defer:l.bool,delay:l.number})},d),f=function(n){return"function"===typeof n},h=function(n){return n in d},v=function(n){return n.substr(2)},g=function(n,e,t,o,i){return function(n,e,t,o,i,r,a){var s=Object.keys(i).filter(h),c=Object.keys(r).filter(h),l=s.filter((function(n){return void 0===r[n]})),u=c.filter((function(n){return void 0===i[n]}));l.forEach((function(n){var e=v(n),o=a[e];t(e,o),delete a[e]})),u.forEach((function(t){var i=o(n,t),r=v(t);a[r]=i,e(r,i)}))}(i,n.on.bind(n),n.off.bind(n),(function(e,t){return function(o){var i;return null===(i=e(t))||void 0===i?void 0:i(o,n)}}),e,t,o)},b=0,y=function(n){var e=Date.now();return n+"_"+Math.floor(1e9*Math.random())+ ++b+String(e)},m=function(n){return null!==n&&("textarea"===n.tagName.toLowerCase()||"input"===n.tagName.toLowerCase())},C=function(n){return"undefined"===typeof n||""===n?[]:Array.isArray(n)?n:n.split(" ")},k=function(){return{listeners:[],scriptId:y("tiny-script"),scriptLoading:!1,scriptLoaded:!1}},w=function(){var n=k();return{load:function(e,t,o,i,r,a){var s=function(){return function(n,e,t,o,i,r){var a=e.createElement("script");a.referrerPolicy="origin",a.type="application/javascript",a.id=n,a.src=t,a.async=o,a.defer=i,a.addEventListener("load",(function n(){a.removeEventListener("load",n),r()})),e.head&&e.head.appendChild(a)}(n.scriptId,e,t,o,i,(function(){n.listeners.forEach((function(n){return n()})),n.scriptLoaded=!0}))};n.scriptLoaded?a():(n.listeners.push(a),n.scriptLoading||(n.scriptLoading=!0,r>0?setTimeout(s,r):s()))},reinitialize:function(){n=k()}}}(),S=function(){var n="undefined"!==typeof window?window:t.g;return n&&n.tinymce?n.tinymce:null},E=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])},n(e,t)};return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),x=function(){return x=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},x.apply(this,arguments)},B=function(){var n,e,t;return(null===(t=null===(e=null===(n=S())||void 0===n?void 0:n.Env)||void 0===e?void 0:e.browser)||void 0===t?void 0:t.isIE())?"change keyup compositionend setcontent":"change input compositionend setcontent"},I=function(){return window.InputEvent&&"function"===typeof InputEvent.prototype.getTargetRanges?"beforeinput SelectionChange":"SelectionChange"},R=function(n){function e(e){var t,o,i,r=n.call(this,e)||this;return r.rollbackTimer=void 0,r.valueCursor=void 0,r.rollbackChange=function(){var n=r.editor,e=r.props.value;n&&e&&e!==r.currentContent&&n.undoManager.ignore((function(){if(n.setContent(e),r.valueCursor&&(!r.inline||n.hasFocus()))try{n.selection.moveToBookmark(r.valueCursor)}catch(t){}})),r.rollbackTimer=void 0},r.handleBeforeInput=function(n){if(void 0!==r.props.value&&r.props.value===r.currentContent&&r.editor&&(!r.inline||r.editor.hasFocus))try{r.valueCursor=r.editor.selection.getBookmark(3)}catch(e){}},r.handleBeforeInputSpecial=function(n){"Enter"!==n.key&&"Backspace"!==n.key&&"Delete"!==n.key||r.handleBeforeInput(n)},r.handleEditorChange=function(n){var e=r.editor;if(e&&e.initialized){var t=e.getContent();if(void 0!==r.props.value&&r.props.value!==t&&!1!==r.props.rollback&&(r.rollbackTimer||(r.rollbackTimer=window.setTimeout(r.rollbackChange,"number"===typeof r.props.rollback?r.props.rollback:200))),t!==r.currentContent&&(r.currentContent=t,f(r.props.onEditorChange))){var o=r.props.outputFormat,i="html"===o?t:e.getContent({format:o});r.props.onEditorChange(i,e)}}},r.handleEditorChangeSpecial=function(n){"Backspace"!==n.key&&"Delete"!==n.key||r.handleEditorChange(n)},r.initialise=function(n){var e,t,o;void 0===n&&(n=0);var i=r.elementRef.current;if(i)if(function(n){if(!("isConnected"in Node.prototype)){for(var e=n,t=n.parentNode;null!=t;)t=(e=t).parentNode;return e===n.ownerDocument}return n.isConnected}(i)){var a=S();if(!a)throw new Error("tinymce should have been loaded into global scope");var s,c,l=x(x({},r.props.init),{selector:void 0,target:i,readonly:r.props.disabled,inline:r.inline,plugins:(s=null===(e=r.props.init)||void 0===e?void 0:e.plugins,c=r.props.plugins,C(s).concat(C(c))),toolbar:null!==(t=r.props.toolbar)&&void 0!==t?t:null===(o=r.props.init)||void 0===o?void 0:o.toolbar,setup:function(n){r.editor=n,r.bindHandlers({}),r.inline&&!m(i)&&n.once("PostRender",(function(e){n.setContent(r.getInitialValue(),{no_events:!0})})),r.props.init&&f(r.props.init.setup)&&r.props.init.setup(n)},init_instance_callback:function(n){var e,t,o=r.getInitialValue();r.currentContent=null!==(e=r.currentContent)&&void 0!==e?e:n.getContent(),r.currentContent!==o&&(r.currentContent=o,n.setContent(o),n.undoManager.clear(),n.undoManager.add(),n.setDirty(!1));var i=null!==(t=r.props.disabled)&&void 0!==t&&t;n.setMode(i?"readonly":"design"),r.props.init&&f(r.props.init.init_instance_callback)&&r.props.init.init_instance_callback(n)}});r.inline||(i.style.visibility=""),m(i)&&(i.value=r.getInitialValue()),a.init(l)}else if(0===n)setTimeout((function(){return r.initialise(1)}),1);else{if(!(n<100))throw new Error("tinymce can only be initialised when in a document");setTimeout((function(){return r.initialise(n+1)}),100)}},r.id=r.props.id||y("tiny-react"),r.elementRef=s.createRef(),r.inline=null!==(i=null!==(t=r.props.inline)&&void 0!==t?t:null===(o=r.props.init)||void 0===o?void 0:o.inline)&&void 0!==i&&i,r.boundHandlers={},r}return E(e,n),e.prototype.componentDidUpdate=function(n){var e,t,o=this;if(this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(n),this.editor.initialized)){if(this.currentContent=null!==(e=this.currentContent)&&void 0!==e?e:this.editor.getContent(),"string"===typeof this.props.initialValue&&this.props.initialValue!==n.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if("string"===typeof this.props.value&&this.props.value!==this.currentContent){var i=this.editor;i.undoManager.transact((function(){var n;if(!o.inline||i.hasFocus())try{n=i.selection.getBookmark(3)}catch(s){}var e=o.valueCursor;if(i.setContent(o.props.value),!o.inline||i.hasFocus())for(var t=0,r=[n,e];t<r.length;t++){var a=r[t];if(a)try{i.selection.moveToBookmark(a),o.valueCursor=a;break}catch(s){}}}))}if(this.props.disabled!==n.disabled){var r=null!==(t=this.props.disabled)&&void 0!==t&&t;this.editor.setMode(r?"readonly":"design")}}},e.prototype.componentDidMount=function(){var n,e,t,o,i,r;null!==S()?this.initialise():this.elementRef.current&&this.elementRef.current.ownerDocument&&w.load(this.elementRef.current.ownerDocument,this.getScriptSrc(),null!==(e=null===(n=this.props.scriptLoading)||void 0===n?void 0:n.async)&&void 0!==e&&e,null!==(o=null===(t=this.props.scriptLoading)||void 0===t?void 0:t.defer)&&void 0!==o&&o,null!==(r=null===(i=this.props.scriptLoading)||void 0===i?void 0:i.delay)&&void 0!==r?r:0,this.initialise)},e.prototype.componentWillUnmount=function(){var n=this,e=this.editor;e&&(e.off(B(),this.handleEditorChange),e.off(I(),this.handleBeforeInput),e.off("keypress",this.handleEditorChangeSpecial),e.off("keydown",this.handleBeforeInputSpecial),e.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach((function(t){e.off(t,n.boundHandlers[t])})),this.boundHandlers={},e.remove(),this.editor=void 0)},e.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},e.prototype.renderInline=function(){var n=this.props.tagName,e=void 0===n?"div":n;return s.createElement(e,{ref:this.elementRef,id:this.id})},e.prototype.renderIframe=function(){return s.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id})},e.prototype.getScriptSrc=function(){if("string"===typeof this.props.tinymceScriptSrc)return this.props.tinymceScriptSrc;var n=this.props.cloudChannel;return"https://cdn.tiny.cloud/1/"+(this.props.apiKey?this.props.apiKey:"no-api-key")+"/tinymce/"+n+"/tinymce.min.js"},e.prototype.getInitialValue=function(){return"string"===typeof this.props.initialValue?this.props.initialValue:"string"===typeof this.props.value?this.props.value:""},e.prototype.bindHandlers=function(n){var e=this;if(void 0!==this.editor){g(this.editor,n,this.props,this.boundHandlers,(function(n){return e.props[n]}));var t=function(n){return void 0!==n.onEditorChange||void 0!==n.value},o=t(n),i=t(this.props);!o&&i?(this.editor.on(B(),this.handleEditorChange),this.editor.on(I(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):o&&!i&&(this.editor.off(B(),this.handleEditorChange),this.editor.off(I(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},e.propTypes=p,e.defaultProps={cloudChannel:"5"},e}(s.Component),O=t(60309),T=t(89854),D=t(38545),M=t(80184),j=c.ZP.div(o||(o=(0,a.Z)(["\n  && {\n    width: 100%;\n    height: 100%;\n    .tox .tox-editor-header {\n      z-index: 0;\n    }\n\n    .tox-tinymce {\n      border-radius: ",";\n      box-shadow: "," !important;\n    }\n  }\n  .tox {\n    width: 100%;\n    .tox-tbtn {\n      cursor: pointer;\n      .tox-tbtn__select-label {\n        cursor: inherit;\n      }\n    }\n  }\n\n  ","\n"])),(function(n){return n.borderRadius}),(function(n){var e=n.boxShadow;return"".concat(e)}),T.a1),_=c.ZP.div(i||(i=(0,a.Z)(["\n  display: flex;\n  width: 100%;\n  min-width: 0;\n  height: 100%;\n  border: 1px solid ",";\n  border-radius: ",";\n"])),(function(n){return n.isValid?"none":O.w.DANGER_SOLID}),(function(n){return n.borderRadius}));function P(n){var e=n.compactMode,t=n.isDisabled,o=n.labelAlignment,i=n.labelPosition,a=n.labelStyle,c=n.labelText,l=n.labelTextColor,u=n.labelTextSize,d=n.labelWidth,p=(0,s.useState)(n.value),f=(0,r.Z)(p,2),h=f[0],v=f[1],g=(0,s.useRef)(!0),b=(0,s.useCallback)((function(e,t){e!==h&&(t.hasFocus()&&(v(e),n.onValueChange(e)))}),[n.onValueChange,h]);return(0,s.useEffect)((function(){g.current||h===n.value?g.current=!1:v(n.value)}),[n.value]),(0,M.jsxs)(j,{borderRadius:n.borderRadius,boxShadow:n.boxShadow,className:"container-".concat(n.widgetId),compactMode:e,"data-testid":"rte-container",labelPosition:i,children:[c&&(0,M.jsx)(T.ZP,{alignment:o,className:"rich-text-editor-label",color:l,compact:e,disabled:t,fontSize:u,fontStyle:a,position:i,text:c,width:d}),(0,M.jsx)(_,{borderRadius:n.borderRadius,isValid:n.isValid,children:(0,M.jsx)(R,{disabled:n.isDisabled,id:"rte-".concat(n.widgetId),init:{height:"100%",menubar:!1,toolbar_mode:"sliding",forced_root_block:"p",branding:!1,resize:!1,browser_spellcheck:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help"],contextmenu:"link useBrowserSpellcheck image table",setup:function(n){n.ui.registry.addMenuItem("useBrowserSpellcheck",{text:'Use "'.concat((0,D.Q5)()?"Control":"Ctrl",' + Right click" to access spellchecker'),onAction:function(){n.notificationManager.open({text:"To access the spellchecker, hold the ".concat((0,D.Q5)()?"Control":"Ctrl"," key and right-click on the misspelt word."),type:"info",timeout:5e3,closeButton:!0})}}),n.ui.registry.addContextMenu("useBrowserSpellcheck",{update:function(){return n.selection.isCollapsed()?["useBrowserSpellcheck"]:[]}})}},onEditorChange:b,tinymceScriptSrc:"https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.10.1/tinymce.min.js",toolbar:!n.isToolbarHidden&&"insertfile undo redo | formatselect | bold italic backcolor forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | removeformat | table | print preview media | forecolor backcolor emoticons' | help",value:h},"editor_".concat(n.isToolbarHidden))})]})}var L=P}}]);
//# sourceMappingURL=rte.df1105d6.chunk.js.map